<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">

<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>

<div class="container mt-4">
  <h1 class="mb-4">Founders Card Sample App Barry Weinstein</h1>

  <!-- Search & Filters -->
  <div class="row mb-4">
    <div class="col-md-4">
      <input type="text" id="search" class="form-control" placeholder="Search experiences...">
    </div>
    <div class="col-md-3">
<select id="category-select">
  <option value="">All Categories</option>
  <% @categories.each do |cat| %>
    <option value="<%= cat.id %>"><%= cat.name %></option>
  <% end %>
</select>

<div id="experiences-container"></div>
    </div>
    <div class="col-md-2">
      <input type="number" id="min_price" class="form-control" placeholder="Min Price">
    </div>
    <div class="col-md-2">
      <input type="number" id="max_price" class="form-control" placeholder="Max Price">
    </div>
  </div>

  <!-- Experiences Grid -->
  <div class="row" id="experiences-list">
      <%= render partial: "experience_card", collection: @experiences, as: :exp %>
  </div>
</div>

<script>


document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("search");
  const categorySelect = document.getElementById("category-select");
  const container = document.getElementById("experiences-list"); // use the experiences-list div
  const minPriceInput = document.getElementById("min_price");
  const maxPriceInput = document.getElementById("max_price");

  function fetchExperiences() {
  const search = searchInput.value;
  const categoryId = categorySelect.value;
  const minPrice = minPriceInput.value;  // <-- must be here
  const maxPrice = maxPriceInput.value;  // <-- must be here

  const params = new URLSearchParams();
  if (search) params.append("search", search);
  if (categoryId) params.append("category_id", categoryId);
  if (minPrice) params.append("min_price", minPrice);
  if (maxPrice) params.append("max_price", maxPrice);

  fetch(`/experience/filter.json?${params.toString()}`)
    .then(res => res.json())
    .then(data => {
      container.innerHTML = "";
      if (data.length === 0) {
        container.innerHTML = "<p>No experiences found.</p>";
      } else {
        data.forEach(exp => {
          container.innerHTML += `
            <div class="col-md-4 mb-3">
              <div class="card h-100">
                <img src="${exp.image_url || ''}" class="card-img-top" alt="${exp.venue_name}">
                <div class="card-body">
                  <h5 class="card-title">${exp.venue_name}</h5>
                  <p class="card-text">${exp.description}</p>
                  <p class="card-text">$${exp.price}</p>
                </div>
                <div class="card-footer">
                  <a href="${exp.booking_link || '#'}" class="btn btn-primary btn-sm">Book Now</a>
                </div>
              </div>
            </div>
          `;
        });
      }
    })
    .catch(err => console.error("Fetch error:", err));
}



  maxPriceInput.addEventListener("keyup", fetchExperiences);
  minPriceInput.addEventListener("keyup", fetchExperiences);
  searchInput.addEventListener("keyup", fetchExperiences);
  categorySelect.addEventListener("change", fetchExperiences);
});


</script>

